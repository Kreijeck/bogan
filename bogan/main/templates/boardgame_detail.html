{% extends 'base.html' %}

{% block content %}

<!-- Oberer Bereich: Brettspiel-Details -->
<section class="section">
  <div class="container">
    <h1 class="title has-text-primary collapsible-header" data-target="boardgame-details">
      <span class="icon-text">
        <span class="icon has-text-primary">
          <i class="fas fa-dice"></i>
        </span>
        <span>{{ boardgame.name }}</span>
        <span class="icon collapse-icon">
          <i class="fas fa-chevron-up"></i>
        </span>
      </span>
    </h1>
    
    <div id="boardgame-details" class="collapsible-content">
      <div class="columns">
        <!-- Spalte für das Bild -->
        <div class="column is-one-third">
          <figure class="image">
            <!-- Hier ggf. eigenes Bild angeben -->
            <img src="{{ boardgame.img }}" alt="Spielbox {{ boardgame.name }}" />
          </figure>
        </div>
        <!-- Spalte für die Spiel-Informationen -->
        <div class="column">
          <p><strong>Spieldauer:</strong> ca. {{ boardgame.playtime }} Minuten</p>
          <p><strong>Komplexität:</strong> {{ boardgame.weight }} / 5</p>
          <p><strong>Spieleranzahl:</strong> {{ boardgame.minplayers }} - {{ boardgame.maxplayers }}</p>
          <p><strong>Erscheinungsjahr:</strong> {{ boardgame.yearpublished }}</p>
          <p><strong>BGG ID</strong> {{ boardgame.bgg_id }}</p>
        </div>
      </div>
      
      <!-- Allgemeine Spielstatistiken -->
      {% if game_stats and game_stats.total_games > 0 %}
      <div class="box game-stats-box mt-5">
        <div class="columns is-mobile">
          <div class="column has-text-centered">
            <p class="heading">Gespielt</p>
            <p class="title is-4 has-text-white">{{ game_stats.total_games }}</p>
          </div>
          <div class="column has-text-centered">
            <p class="heading">Ø Punkte</p>
            <p class="title is-4 has-text-white">{{ game_stats.avg_points }}</p>
          </div>
          <div class="column has-text-centered">
            <p class="heading">Höchste</p>
            <p class="title is-4 has-text-white">{{ game_stats.highest_score }}</p>
          </div>
          <div class="column has-text-centered">
            <p class="heading">Niedrigste</p>
            <p class="title is-4 has-text-white">{{ game_stats.lowest_score }}</p>
          </div>
          {% if game_stats.avg_playtime > 0 %}
          <div class="column has-text-centered">
            <p class="heading">Ø Spielzeit</p>
            <p class="title is-4 has-text-white">{{ game_stats.avg_playtime }} min</p>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Gespielte Partien -->
<section class="section">
  <div class="container">
    <h2 class="title is-3 has-text-primary collapsible-header" data-target="game-history">
      <span class="icon-text">
        <span class="icon has-text-primary">
          <i class="fas fa-history"></i>
        </span>
        <span>Gespielte Partien</span>
        <span class="icon collapse-icon">
          <i class="fas fa-chevron-up"></i>
        </span>
      </span>
    </h2>
    
    <div id="game-history" class="collapsible-content">
      <div class="columns is-multiline">
        <!-- Alle gespielte Partien -->
        {% for game in games %}
        <div class="column is-half">
          <article class="box">
            <h3 class="title is-5">Partie vom {{ game.datum.strftime('%d.%b %Y') }}</h3>
            <!-- Sieger -->
            <p class="has-text-info-50"><strong class="has-text-info-60">Sieger:</strong> {{game.player_pos[0].player.name}} </p>
            <p> <br> </p>
            <p><strong>Spieler (Punkte):</strong>
              {% for player in game.player_pos %}
            <p> Pos {{ loop.index}}: <strong>{{ player.player.name }}</strong> ({{ player.points }} Punkte) </p>
            {% endfor %}
            <p> <br> </p>
            <p><strong>Spielzeit[min]</strong> {{ '-' if game.playtime < 15 else game.playtime }}</p>
            <p><strong>Ort</strong> {{ game.location.name }}</p>

          </article>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- Spieler-Ranking für dieses Brettspiel -->
{% if player_ranking %}
<section class="section">
  <div class="container">
    <h2 class="title is-3 has-text-centered has-text-primary collapsible-header" data-target="player-ranking">
      <span class="icon-text">
        <span class="icon has-text-primary">
          <i class="fas fa-trophy"></i>
        </span>
        <span>Spieler-Ranking für {{ boardgame.name }}</span>
        <span class="icon collapse-icon">
          <i class="fas fa-chevron-up"></i>
        </span>
      </span>
    </h2>
    <p class="subtitle has-text-centered mb-6 has-text-grey-dark">
      Leistung aller Spieler in diesem Spiel
    </p>

    <div id="player-ranking" class="collapsible-content">
      <div class="columns is-multiline">
        {% for player in player_ranking %}
        <div class="column is-half-tablet is-one-third-desktop">
          <div class="box player-rank-box">
            <div class="media">
              <div class="media-left">
                <div class="rank-badge rank-{{ loop.index }}">
                  {% if loop.index == 1 %}
                    <i class="fas fa-crown"></i>
                  {% elif loop.index == 2 %}
                    <i class="fas fa-medal"></i>
                  {% elif loop.index == 3 %}
                    <i class="fas fa-award"></i>
                  {% else %}
                    {{ loop.index }}
                  {% endif %}
                </div>
              </div>
              <div class="media-content">
                <p class="title is-5">{{ player.name }}</p>
                <p class="subtitle is-6 has-text-grey">
                  {{ player.games_played }} Spiel{{ 'e' if player.games_played != 1 else '' }}
                </p>
              </div>
            </div>
            
            <div class="content">
              <div class="columns is-gapless is-multiline">
                <div class="column is-half">
                  <div class="has-text-centered">
                    <p class="heading">Durchschnitt</p>
                    <p class="title is-6 has-text-primary">{{ player.avg_points }} Pkt</p>
                  </div>
                </div>
                <div class="column is-half">
                  <div class="has-text-centered">
                    <p class="heading">Ø Position</p>
                    <p class="title is-6 has-text-info">{{ player.avg_position }}</p>
                  </div>
                </div>
                <div class="column is-half">
                  <div class="has-text-centered">
                    <p class="heading">Siegquote</p>
                    <p class="title is-6 has-text-success">{{ player.win_rate }}%</p>
                  </div>
                </div>
                <div class="column is-half">
                  <div class="has-text-centered">
                    <p class="heading">Siege</p>
                    <p class="title is-6 has-text-warning">{{ player.wins }}</p>
                  </div>
                </div>
              </div>
              
              <hr class="my-3">
              
              <div class="level is-mobile">
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Bester Score</p>
                    <p class="title is-6">{{ player.best_score }}</p>
                  </div>
                </div>
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Schlechtester</p>
                    <p class="title is-6">{{ player.worst_score }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endif %}


{% endblock %}