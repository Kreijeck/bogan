{% extends 'base.html' %}

{% block content %}
<div class="columns is-centered">
    <div class="column is-two-thirds">
        <h1 class="title">Profil von {{ name }}</h1>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="notification {% if category == 'error' %}is-danger{% elif category == 'success' %}is-success{% else %}is-info{% endif %}">
                        <button class="delete" onclick="this.parentElement.style.display='none';"></button>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="box">
            <h2 class="subtitle">Spieler-Verkn√ºpfung</h2>
            
            {% if current_player %}
                <!-- Bereits verkn√ºpft -->
                <div class="notification is-dark">
                    <h3 class="title is-5">üéØ Du bist verkn√ºpft mit:</h3>
                    <p class="subtitle is-6">
                        <strong>{{ current_player.name }}</strong>
                        {% if current_player.bgg_name %}
                            (BGG: {{ current_player.bgg_name }})
                        {% endif %}
                    </p>
                    <div class="buttons">
                        <a href="{{ url_for('main.show_player', player_name=current_player.name) }}" class="button is-link is-light">
                            <span class="icon">
                                <i class="fas fa-user"></i>
                            </span>
                            <span>Zu meiner Spielerseite</span>
                        </a>
                        <form method="POST" action="{{ url_for('main.unlink_player') }}" style="display: inline;">
                            <button type="submit" class="button is-danger is-outlined" 
                                    onclick="return confirm('M√∂chtest du die Verkn√ºpfung wirklich entfernen?')">
                                <span class="icon">
                                    <i class="fas fa-unlink"></i>
                                </span>
                                <span>Verkn√ºpfung entfernen</span>
                            </button>
                        </form>
                    </div>
                </div>
            {% else %}
                <!-- Noch nicht verkn√ºpft -->
                <div class="notification is-primary is-dark">
                    <h3 class="title is-5">‚ö†Ô∏è Nicht mit einem Spieler verkn√ºpft</h3>
                    <p>Du bist noch nicht mit einem Spieler verkn√ºpft. W√§hle einen Spieler aus der Liste unten aus, um deine Spielstatistiken zu sehen.</p>
                </div>
                
                {% if available_players %}
                    <form method="POST" action="{{ url_for('main.link_player') }}">
                        <div class="field">
                            <label class="label">Verf√ºgbare Spieler:</label>
                            <div class="control">
                                <div class="select is-fullwidth">
                                    <select name="player_id" required>
                                        <option value="">W√§hle einen Spieler...</option>
                                        {% for player in available_players %}
                                            <option value="{{ player.id }}">
                                                {{ player.name }}
                                                {% if player.bgg_name %}
                                                    (BGG: {{ player.bgg_name }})
                                                {% endif %}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="field">
                            <div class="control">
                                <button type="submit" class="button is-info">
                                    <span class="icon">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <span>Mit Spieler verkn√ºpfen</span>
                                </button>
                            </div>
                        </div>
                    </form>
                {% else %}
                    <div class="notification is-info">
                        <p>Alle Spieler sind bereits mit anderen Accounts verkn√ºpft oder es sind keine Spieler verf√ºgbar.</p>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
    
{% endblock %}